<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïê Die Uhrzeit - Practica las Horas en Alem√°n</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a25;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-success: #22c55e;
            --accent-error: #ef4444;
            --accent-warning: #f59e0b;
            --accent-info: #3b82f6;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --text-muted: #6b6b80;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ========== SCREEN MANAGEMENT ========== */
        .screen {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== HOME SCREEN ========== */
        .home-header {
            text-align: center;
            padding: 40px 0 30px;
        }

        .home-header .clock-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .home-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .home-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section h2 {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding-left: 5px;
        }

        .menu-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-card:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .menu-card:active {
            transform: scale(0.98);
        }

        .menu-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .menu-card-icon.unofficial {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .menu-card-icon.official {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .menu-card-icon.study {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .menu-card-icon.writing {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }

        .menu-card-icon.birthday {
            background: linear-gradient(135deg, #a855f7, #9333ea);
        }

        .menu-card-icon.grammar {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .menu-card-content h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .menu-card-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .menu-card-arrow {
            margin-left: auto;
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        /* ========== STUDY SCREEN ========== */
        .study-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .study-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-warning), #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .study-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--glass-bg);
            border-radius: 14px;
            padding: 5px;
            border: 1px solid var(--glass-border);
            flex-wrap: wrap;
        }

        .study-tab {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: transparent;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .study-tab.active {
            background: linear-gradient(135deg, var(--accent-warning), #f97316);
            color: white;
        }

        .study-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .study-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .study-card h3 {
            color: var(--accent-primary);
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .study-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .time-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .time-table th {
            background: var(--glass-bg);
            color: var(--text-primary);
            padding: 10px;
            text-align: left;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .time-table td {
            padding: 10px;
            border-bottom: 1px solid var(--glass-border);
            font-size: 0.85rem;
        }

        .time-table td:first-child {
            color: var(--accent-primary);
            font-weight: 600;
            width: 60px;
        }

        .time-table td:last-child {
            color: var(--text-secondary);
        }

        .highlight-box {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .highlight-box.info {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .highlight-box h4 {
            color: var(--accent-warning);
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .highlight-box.info h4 {
            color: var(--accent-info);
        }

        .highlight-box p {
            margin: 0;
            font-size: 0.85rem;
        }

        .example-row {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--glass-bg);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .example-time {
            min-width: 60px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .example-german {
            flex: 1;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        /* ========== GAME SCREEN ========== */
        .game-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .game-header h1 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .game-header h1.unofficial {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-header h1.official {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-header h1.birthday {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Mode Selector */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 6px;
            border: 1px solid var(--glass-border);
        }

        .mode-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            background: transparent;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .mode-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid var(--glass-border);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-value.correct {
            color: var(--accent-success);
        }

        .stat-value.incorrect {
            color: var(--accent-error);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Clock Container */
        .clock-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
        }

        .clock {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #1e1e2a, #151520);
            box-shadow:
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 2px 10px rgba(255, 255, 255, 0.05);
            position: relative;
            border: 3px solid var(--glass-border);
        }

        .clock-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .clock-center {
            position: absolute;
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        .hour-hand,
        .minute-hand {
            position: absolute;
            background: linear-gradient(to top, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
            transform-origin: bottom center;
            left: 50%;
            bottom: 50%;
            box-shadow: 0 0 8px rgba(99, 102, 241, 0.4);
        }

        .hour-hand {
            width: 5px;
            height: 50px;
            margin-left: -2.5px;
        }

        .minute-hand {
            width: 3px;
            height: 65px;
            margin-left: -1.5px;
        }

        .clock-number {
            position: absolute;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clock-number.n12 {
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
        }

        .clock-number.n1 {
            top: 22px;
            right: 32px;
        }

        .clock-number.n2 {
            top: 48px;
            right: 16px;
        }

        .clock-number.n3 {
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
        }

        .clock-number.n4 {
            bottom: 48px;
            right: 16px;
        }

        .clock-number.n5 {
            bottom: 22px;
            right: 32px;
        }

        .clock-number.n6 {
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
        }

        .clock-number.n7 {
            bottom: 22px;
            left: 32px;
        }

        .clock-number.n8 {
            bottom: 48px;
            left: 16px;
        }

        .clock-number.n9 {
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
        }

        .clock-number.n10 {
            top: 48px;
            left: 16px;
        }

        .clock-number.n11 {
            top: 22px;
            left: 32px;
        }

        /* Digital Time Display */
        .digital-time {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-primary);
            font-family: 'Outfit', monospace;
            text-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .date-display {
            text-align: center;
            margin: 40px 0;
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--accent-primary);
            font-family: 'Outfit', sans-serif;
            text-shadow: 0 0 30px rgba(168, 85, 247, 0.4);
            display: none;
            letter-spacing: 2px;
        }

        .date-display-large {
            display: none;
            font-size: 3rem;
            margin: 30px 0;
            text-align: center;
            color: var(--accent-primary);
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
        }

        /* Answer Area */
        .answer-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .instruction {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .answer-slots {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            min-height: 50px;
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 12px;
            border: 2px dashed var(--glass-border);
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .answer-slots.correct {
            border-color: var(--accent-success);
            background: rgba(34, 197, 94, 0.1);
        }

        .answer-slots.incorrect {
            border-color: var(--accent-error);
            background: rgba(239, 68, 68, 0.1);
            animation: shake 0.5s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-5px);
            }

            40%,
            80% {
                transform: translateX(5px);
            }
        }

        .word-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .word-chip {
            padding: 10px 16px;
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-user-select: none;
            user-select: none;
        }

        .word-chip:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .word-chip:active {
            transform: scale(0.95);
        }

        .word-chip.selected {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .word-chip.in-answer {
            opacity: 0.3;
            pointer-events: none;
        }

        .grammar-question-text {
            display: none;
            font-size: 1.5rem;
            text-align: center;
            margin: 20px 0;
            color: var(--text-primary);
        }

        .grammar-pronoun {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .credit-text {
            font-size: 0.8rem;
            color: #8b5cf6;
            margin-top: 8px;
        }

        /* Feedback Section */
        .feedback {
            text-align: center;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: none;
            font-weight: 500;
        }

        .feedback.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .feedback.correct {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-success);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Buttons */
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 14px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* Correct Answer Display */
        .correct-answer-display {
            text-align: center;
            padding: 10px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            margin-bottom: 12px;
            display: none;
            font-size: 0.9rem;
        }

        .correct-answer-display.show {
            display: block;
        }

        .correct-answer-display span {
            color: var(--accent-primary);
            font-weight: 600;
        }

        /* Writing Mode Styles */
        .writing-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-label .badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .input-label .badge.unofficial {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .input-label .badge.official {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .time-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .time-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .time-input::placeholder {
            color: var(--text-muted);
        }

        .time-input.correct {
            border-color: var(--accent-success);
            background: rgba(34, 197, 94, 0.1);
        }

        .time-input.incorrect {
            border-color: var(--accent-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .input-feedback {
            font-size: 0.8rem;
            margin-top: 6px;
            display: none;
        }

        .input-feedback.show {
            display: block;
        }

        .input-feedback.correct {
            color: var(--accent-success);
        }

        .input-feedback.incorrect {
            color: var(--accent-error);
        }

        .game-header h1.writing {
            background: linear-gradient(135deg, #ec4899, #be185d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Responsive */
        @media (max-width: 380px) {
            .clock {
                width: 150px;
                height: 150px;
            }

            .hour-hand {
                height: 40px;
            }

            .minute-hand {
                height: 55px;
            }

            .word-chip {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .home-header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">

        <!-- ========== HOME SCREEN ========== -->
        <div class="screen active" id="homeScreen">
            <div class="home-header">
                <div class="clock-icon">üïê</div>
                <h1>Die Uhrzeit</h1>
                <p>Aprende a decir las horas en alem√°n</p>
                <p class="credit-text">‚ú® GRACIAS A SERGIO ‚ú®</p>
            </div>

            <div class="menu-section">
                <h2>üïí Modo de Juego (Horas)</h2>
                <div class="menu-card" onclick="startGame('unofficial')">
                    <div class="menu-card-icon unofficial">üó£Ô∏è</div>
                    <div class="menu-card-content">
                        <h3>Forma No Oficial</h3>
                        <p>Coloquial: halb acht, Viertel vor...</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
                <div class="menu-card" onclick="startGame('official')">
                    <div class="menu-card-icon official">üì¢</div>
                    <div class="menu-card-content">
                        <h3>Forma Oficial</h3>
                        <p>Formal: sieben Uhr drei√üig</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
                <div class="menu-card" onclick="startGame('writing')">
                    <div class="menu-card-icon writing">‚úçÔ∏è</div>
                    <div class="menu-card-content">
                        <h3>Modo Escritura</h3>
                        <p>Escribe t√∫ la hora completa</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
            </div>

            <div class="menu-section">
                <h2>üéÇ Geburtstage (Fechas)</h2>
                <div class="menu-card" onclick="startGame('birthday_words')">
                    <div class="menu-card-icon birthday">üìÖ</div>
                    <div class="menu-card-content">
                        <h3>Mit Monatsnamen</h3>
                        <p>am vierten Mai</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
                <div class="menu-card" onclick="startGame('birthday_numbers')">
                    <div class="menu-card-icon birthday">üî¢</div>
                    <div class="menu-card-content">
                        <h3>Mit Zahlen (Oficial)</h3>
                        <p>am vierten F√ºnften</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
                <div class="menu-card" onclick="startGame('birthday_writing')">
                    <div class="menu-card-icon birthday">‚úçÔ∏è</div>
                    <div class="menu-card-content">
                        <h3>Modo Escritura</h3>
                        <p>Escribe fechas completas</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
            </div>


            <div class="menu-section">
                <h2>üìò Grammatik (Gram√°tica)</h2>
                <div class="menu-card" onclick="startGame('possessive')">
                    <div class="menu-card-icon grammar">üéí</div>
                    <div class="menu-card-content">
                        <h3>Possessivartikel</h3>
                        <p>mein, dein, sein, ihr...</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
                <div class="menu-card" onclick="startGame('modal')">
                    <div class="menu-card-icon grammar">‚ö°</div>
                    <div class="menu-card-content">
                        <h3>Modalverben</h3>
                        <p>m√ºssen, k√∂nnen, wollen</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
            </div>

            <div class="menu-section">
                <h2>üìö Aprender</h2>
                <div class="menu-card" onclick="showScreen('studyScreen')">
                    <div class="menu-card-icon study">üìñ</div>
                    <div class="menu-card-content">
                        <h3>Secci√≥n de Estudio</h3>
                        <p>Aprende las reglas de las horas</p>
                    </div>
                    <span class="menu-card-arrow">‚Üí</span>
                </div>
            </div>
        </div>

        <!-- ========== STUDY SCREEN ========== -->
        <div class="screen" id="studyScreen">
            <div class="study-header">
                <button class="back-btn" onclick="showScreen('homeScreen')">‚Üê</button>
                <h1>üìö Secci√≥n de Estudio</h1>
            </div>

            <div class="study-tabs">
                <button class="study-tab active" onclick="showStudyTab('unofficial')">üó£Ô∏è No Oficial</button>
                <button class="study-tab" onclick="showStudyTab('official')">üì¢ Oficial</button>
                <button class="study-tab" onclick="showStudyTab('birthday')">üéÇ Geburtstage</button>
                <button class="study-tab" onclick="showStudyTab('possessive')">üéí Possessiv</button>
                <button class="study-tab" onclick="showStudyTab('modal')">‚ö° Modal</button>
            </div>

            <div class="study-content">
                <!-- UNOFFICIAL CONTENT -->
                <div class="study-tab-content active" id="studyUnofficial">
                    <div class="study-card">
                        <h3>üó£Ô∏è ¬øQu√© es la forma No Oficial?</h3>
                        <p>Es la forma <strong>coloquial</strong> que usas con amigos, familia y en situaciones
                            cotidianas. Es m√°s natural en conversaciones diarias.</p>
                    </div>

                    <div class="study-card">
                        <h3>üìê Estructura b√°sica</h3>
                        <p><strong>Es ist</strong> + (expresi√≥n de tiempo)</p>

                        <table class="time-table">
                            <tr>
                                <th>Min</th>
                                <th>Expresi√≥n</th>
                            </tr>
                            <tr>
                                <td>:00</td>
                                <td>Es ist [hora] <strong>Uhr</strong></td>
                            </tr>
                            <tr>
                                <td>:05</td>
                                <td>Es ist f√ºnf <strong>nach</strong> [hora]</td>
                            </tr>
                            <tr>
                                <td>:10</td>
                                <td>Es ist zehn <strong>nach</strong> [hora]</td>
                            </tr>
                            <tr>
                                <td>:15</td>
                                <td>Es ist <strong>Viertel nach</strong> [hora]</td>
                            </tr>
                            <tr>
                                <td>:20</td>
                                <td>Es ist zwanzig <strong>nach</strong> [hora]</td>
                            </tr>
                            <tr>
                                <td>:25</td>
                                <td>Es ist f√ºnf vor <strong>halb</strong> [hora+1]</td>
                            </tr>
                            <tr>
                                <td>:30</td>
                                <td>Es ist <strong>halb</strong> [hora+1]</td>
                            </tr>
                            <tr>
                                <td>:35</td>
                                <td>Es ist f√ºnf nach <strong>halb</strong> [hora+1]</td>
                            </tr>
                            <tr>
                                <td>:40</td>
                                <td>Es ist zwanzig <strong>vor</strong> [hora+1]</td>
                            </tr>
                            <tr>
                                <td>:45</td>
                                <td>Es ist <strong>Viertel vor</strong> [hora+1]</td>
                            </tr>
                            <tr>
                                <td>:50</td>
                                <td>Es ist zehn <strong>vor</strong> [hora+1]</td>
                            </tr>
                            <tr>
                                <td>:55</td>
                                <td>Es ist f√ºnf <strong>vor</strong> [hora+1]</td>
                            </tr>
                        </table>
                    </div>

                    <div class="highlight-box">
                        <h4>‚ö†Ô∏è ¬°Muy importante!</h4>
                        <p>En <strong>halb</strong> (media hora), se usa <strong>la hora siguiente</strong>:</p>
                        <p>‚Ä¢ 7:30 = halb <strong>acht</strong> (no halb sieben)</p>
                        <p>‚Ä¢ 9:30 = halb <strong>zehn</strong></p>
                    </div>

                    <div class="study-card">
                        <h3>‚úèÔ∏è Ejemplos pr√°cticos</h3>
                        <div class="example-row">
                            <span class="example-time">7:00</span>
                            <span class="example-german">Es ist sieben Uhr</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">7:15</span>
                            <span class="example-german">Es ist Viertel nach sieben</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">7:30</span>
                            <span class="example-german">Es ist halb acht</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">7:45</span>
                            <span class="example-german">Es ist Viertel vor acht</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">8:50</span>
                            <span class="example-german">Es ist zehn vor neun</span>
                        </div>
                    </div>

                    <div class="study-card">
                        <h3>üí° Vocabulario clave</h3>
                        <p><strong>nach</strong> = despu√©s de (para minutos 1-29)</p>
                        <p><strong>vor</strong> = antes de (para minutos 31-59)</p>
                        <p><strong>halb</strong> = media (¬°con la hora siguiente!)</p>
                        <p><strong>Viertel</strong> = cuarto (15 minutos)</p>
                    </div>
                </div>

                <!-- OFFICIAL CONTENT -->
                <div class="study-tab-content" id="studyOfficial">
                    <div class="study-card">
                        <h3>üì¢ ¬øQu√© es la forma Oficial?</h3>
                        <p>Es la forma <strong>formal</strong> que se usa en estaciones, hospitales, aeropuertos, cines,
                            anuncios y contextos profesionales.</p>
                    </div>

                    <div class="study-card">
                        <h3>üìê Estructura b√°sica</h3>
                        <p><strong>Es ist</strong> + [hora] + <strong>Uhr</strong> + [minutos]</p>

                        <div class="highlight-box info">
                            <h4>‚ÑπÔ∏è Nota importante</h4>
                            <p>Aunque el horario se muestra en formato 24h (como 14:30), verbalmente se dice usando
                                n√∫meros del 1-12.</p>
                        </div>
                    </div>

                    <div class="study-card">
                        <h3>‚úèÔ∏è Ejemplos pr√°cticos</h3>
                        <div class="example-row">
                            <span class="example-time">07:00</span>
                            <span class="example-german">Es ist sieben Uhr</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">07:15</span>
                            <span class="example-german">Es ist sieben Uhr f√ºnfzehn</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">07:30</span>
                            <span class="example-german">Es ist sieben Uhr drei√üig</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">07:45</span>
                            <span class="example-german">Es ist sieben Uhr f√ºnfundvierzig</span>
                        </div>
                        <div class="example-row">
                            <span class="example-time">21:45</span>
                            <span class="example-german">Es ist neun Uhr f√ºnfundvierzig</span>
                        </div>
                    </div>

                    <div class="study-card">
                        <h3>üîÑ Comparaci√≥n: Oficial vs No Oficial</h3>
                        <table class="time-table">
                            <tr>
                                <th>Hora</th>
                                <th>Oficial</th>
                            </tr>
                            <tr>
                                <td>8:00</td>
                                <td>acht Uhr</td>
                            </tr>
                            <tr>
                                <td>8:05</td>
                                <td>acht Uhr f√ºnf</td>
                            </tr>
                            <tr>
                                <td>8:15</td>
                                <td>acht Uhr f√ºnfzehn</td>
                            </tr>
                            <tr>
                                <td>8:30</td>
                                <td>acht Uhr drei√üig</td>
                            </tr>
                            <tr>
                                <td>8:45</td>
                                <td>acht Uhr f√ºnfundvierzig</td>
                            </tr>
                        </table>
                    </div>

                    <div class="highlight-box">
                        <h4>‚ö†Ô∏è Diferencia con No Oficial</h4>
                        <p>En la forma oficial <strong>NO</strong> usas "halb", "Viertel", "nach" ni "vor". Solo dices
                            los n√∫meros directamente.</p>
                    </div>
                </div>
                <div class="study-tab-content" id="studyBirthday">
                    <div class="study-card">
                        <h3>üéÇ ¬øC√≥mo decir fechas?</h3>
                        <p>Para decir cu√°ndo es un cumplea√±os o una fecha, usamos la preposici√≥n <strong>am</strong> (an
                            dem) + el n√∫mero ordinal.</p>
                    </div>

                    <div class="study-card">
                        <h3>1Ô∏è‚É£ Regla de los Ordinales</h3>
                        <div class="highlight-box">
                            <h4>De 1 a 19 ¬ª terminaci√≥n -ten</h4>
                            <p>am vier<strong>ten</strong> Mai (04.05.)</p>
                            <p>am elf<strong>ten</strong> September (11.09.)</p>
                        </div>
                        <div class="highlight-box info">
                            <h4>De 20 en adelante ¬ª terminaci√≥n -sten</h4>
                            <p>am zwanzig<strong>sten</strong> April (20.04.)</p>
                            <p>am einunddrei√üig<strong>sten</strong> Dezember (31.12.)</p>
                        </div>
                    </div>

                    <div class="study-card">
                        <h3>‚ö†Ô∏è Excepciones importantes</h3>
                        <p>Algunos n√∫meros cambian irregularmente:</p>
                        <table class="time-table">
                            <tr>
                                <th>N√∫mero</th>
                                <th>Ordinal</th>
                            </tr>
                            <tr>
                                <td>1 (eins)</td>
                                <td>am <strong>ers</strong>ten</td>
                            </tr>
                            <tr>
                                <td>3 (drei)</td>
                                <td>am <strong>drit</strong>ten</td>
                            </tr>
                            <tr>
                                <td>7 (sieben)</td>
                                <td>am <strong>sieb</strong>ten</td>
                            </tr>
                            <tr>
                                <td>8 (acht)</td>
                                <td>am <strong>ach</strong>ten (una t)</td>
                            </tr>
                        </table>
                    </div>

                    <div class="study-card">
                        <h3>üìÖ Dos formas de decirlo</h3>
                        <p><strong>1. Con nombre del mes:</strong></p>
                        <p>am dritten <strong>August</strong></p>
                        <br>
                        <p><strong>2. Con n√∫mero (Oficial):</strong></p>
                        <p>El mes tambi√©n se convierte en ordinal (May√∫scula):</p>
                        <p>am dritten <strong>Achten</strong> (03.08.)</p>
                    </div>

                    <div class="study-card">
                        <h3>üóìÔ∏è Los Meses (Die Monate)</h3>
                        <table class="time-table">
                            <tr>
                                <th>1. Januar</th>
                                <th>7. Juli</th>
                            </tr>
                            <tr>
                                <th>2. Februar</th>
                                <th>8. August</th>
                            </tr>
                            <tr>
                                <th>3. M√§rz</th>
                                <th>9. September</th>
                            </tr>
                            <tr>
                                <th>4. April</th>
                                <th>10. Oktober</th>
                            </tr>
                            <tr>
                                <th>5. Mai</th>
                                <th>11. November</th>
                            </tr>
                            <tr>
                                <th>6. Juni</th>
                                <th>12. Dezember</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- POSSESSIVE CONTENT -->
            <div class="study-tab-content" id="studyPossessive">
                <div class="study-card">
                    <h3>üéí ¬øDe qui√©n es? (Possessivartikel)</h3>
                    <p>Los art√≠culos posesivos indican pertenencia. Cambian seg√∫n la persona (yo -> mi) y el g√©nero de
                        la cosa pose√≠da.</p>
                </div>

                <div class="study-card">
                    <h3>1Ô∏è‚É£ La base (Nominativ)</h3>
                    <table class="time-table">
                        <tr>
                            <th>Persona</th>
                            <th>Posesivo</th>
                            <th>Espa√±ol</th>
                        </tr>
                        <tr>
                            <td>ich</td>
                            <td><strong>mein</strong></td>
                            <td>mi</td>
                        </tr>
                        <tr>
                            <td>du</td>
                            <td><strong>dein</strong></td>
                            <td>tu</td>
                        </tr>
                        <tr>
                            <td>er (√©l) / es (neut)</td>
                            <td><strong>sein</strong></td>
                            <td>su (de √©l)</td>
                        </tr>
                        <tr>
                            <td>sie (ella) / sie (pl)</td>
                            <td><strong>ihr</strong></td>
                            <td>su (de ella/ellos)</td>
                        </tr>
                        <tr>
                            <td>wir</td>
                            <td><strong>unser</strong></td>
                            <td>nuestro</td>
                        </tr>
                        <tr>
                            <td>ihr</td>
                            <td><strong>euer</strong></td>
                            <td>vuestro</td>
                        </tr>
                        <tr>
                            <td>Sie (Usted)</td>
                            <td><strong>Ihr</strong></td>
                            <td>su (de Usted)</td>
                        </tr>
                    </table>
                </div>

                <div class="highlight-box">
                    <h4>‚ö†Ô∏è La Terminaci√≥n (Endung)</h4>
                    <p>¬°El posesivo debe coincidir con el sustantivo que le sigue!</p>
                    <br>
                    <p>üü¶ <strong>Masculino / Neutro:</strong> NO se a√±ade nada.</p>
                    <p>‚Ä¢ Das ist <strong>mein</strong> Vater (m).</p>
                    <p>‚Ä¢ Das ist <strong>dein</strong> Buch (n).</p>
                    <br>
                    <p>üü• <strong>Femenino / Plural:</strong> Se a√±ade <strong>-e</strong>.</p>
                    <p>‚Ä¢ Das ist <strong>meine</strong> Mutter (f).</p>
                    <p>‚Ä¢ Das sind <strong>seine</strong> Eltern (pl).</p>
                </div>

                <div class="highlight-box info">
                    <h4>‚ÑπÔ∏è Ojo con 'euer'</h4>
                    <p>Cuando a√±adimos la 'e' a <strong>euer</strong>, pierde una 'e' intermedia:</p>
                    <p>euer + e = <strong>eure</strong> (no euere)</p>
                </div>
            </div>

            <!-- MODAL CONTENT -->
            <div class="study-tab-content" id="studyModal">
                <div class="study-card">
                    <h3>‚ö° Verbos Modales</h3>
                    <p>Modifican el significado de una acci√≥n (deber, poder, querer). Son irregulares en singular.</p>
                </div>

                <div class="study-card">
                    <h3>1Ô∏è‚É£ Conjugaci√≥n (Presente)</h3>
                    <table class="time-table">
                        <tr>
                            <th> </th>
                            <th>m√ºssen<br><small>(deber)</small></th>
                            <th>k√∂nnen<br><small>(poder)</small></th>
                            <th>wollen<br><small>(querer)</small></th>
                        </tr>
                        <tr>
                            <td>ich</td>
                            <td>muss</td>
                            <td>kann</td>
                            <td>will</td>
                        </tr>
                        <tr>
                            <td>du</td>
                            <td>musst</td>
                            <td>kannst</td>
                            <td>willst</td>
                        </tr>
                        <tr>
                            <td>er/sie/es</td>
                            <td><strong>muss</strong></td>
                            <td><strong>kann</strong></td>
                            <td><strong>will</strong></td>
                        </tr>
                        <tr>
                            <td>wir</td>
                            <td>m√ºssen</td>
                            <td>k√∂nnen</td>
                            <td>wollen</td>
                        </tr>
                        <tr>
                            <td>ihr</td>
                            <td>m√ºsst</td>
                            <td>k√∂nnt</td>
                            <td>wollt</td>
                        </tr>
                        <tr>
                            <td>sie/Sie</td>
                            <td>m√ºssen</td>
                            <td>k√∂nnen</td>
                            <td>wollen</td>
                        </tr>
                    </table>
                </div>

                <div class="highlight-box">
                    <h4>‚ö†Ô∏è Regla de Oro</h4>
                    <p>La 1¬™ y 3¬™ persona del singular son <strong>IGUALES</strong> y no tienen 't'.</p>
                    <p>‚úÖ er kann (NO er kannt)</p>
                    <p>‚úÖ ich will (NO ich wille)</p>
                </div>

                <div class="study-card">
                    <h3>2Ô∏è‚É£ Estructura de la frase</h3>
                    <p>El verbo modal va conjugado en posici√≥n 2. El otro verbo va al <strong>FINAL</strong> en
                        infinitivo.</p>
                    <br>
                    <div class="example-row">
                        <span class="example-german">Ich <strong>muss</strong> heute lernen.</span>
                        <br><small>(Debo aprender hoy)</small>
                    </div>
                </div>
            </div>
        </div>


        <!-- ========== GAME SCREEN ========== -->
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <button class="back-btn" onclick="showScreen('homeScreen')">‚Üê</button>
                <h1 id="gameModeTitle" class="unofficial">üó£Ô∏è Forma No Oficial</h1>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">Racha</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value correct" id="correct">0</div>
                    <div class="stat-label">Correctas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value incorrect" id="incorrect">0</div>
                    <div class="stat-label">Errores</div>
                </div>
            </div>

            <div class="clock-container">
                <div class="clock">
                    <div class="clock-face">
                        <span class="clock-number n12">12</span>
                        <span class="clock-number n1">1</span>
                        <span class="clock-number n2">2</span>
                        <span class="clock-number n3">3</span>
                        <span class="clock-number n4">4</span>
                        <span class="clock-number n5">5</span>
                        <span class="clock-number n6">6</span>
                        <span class="clock-number n7">7</span>
                        <span class="clock-number n8">8</span>
                        <span class="clock-number n9">9</span>
                        <span class="clock-number n10">10</span>
                        <span class="clock-number n11">11</span>
                    </div>
                    <div class="hour-hand" id="hourHand"></div>
                    <div class="minute-hand" id="minuteHand"></div>
                    <div class="clock-center"></div>
                </div>
            </div>

            <div class="digital-time" id="digitalTime">07:30</div>
            <div class="date-display" id="dateDisplay">04.09.</div>

            <div class="grammar-question-text" id="grammarQuestion"></div>

            <div class="answer-section">
                <p class="instruction">Ordena las palabras para formar la hora correcta:</p>

                <div class="answer-slots" id="answerSlots"></div>

                <div class="word-options" id="wordOptions"></div>

                <div class="feedback" id="feedback"></div>

                <div class="correct-answer-display" id="correctAnswerDisplay">
                    Respuesta correcta: <span id="correctAnswerText"></span>
                </div>

                <div class="buttons">
                    <button class="btn btn-secondary" onclick="clearAnswer()">üîÑ Limpiar</button>
                    <button class="btn btn-primary" onclick="checkAnswer()">‚úì Comprobar</button>
                </div>
            </div>
        </div>

        <!-- ========== WRITING GAME SCREEN ========== -->
        <div class="screen" id="writingScreen">
            <div class="game-header">
                <button class="back-btn" onclick="showScreen('homeScreen')">‚Üê</button>
                <h1 id="writingModeTitle" class="writing">‚úçÔ∏è Modo Escritura</h1>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="writingStreak">0</div>
                    <div class="stat-label">Racha</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value correct" id="writingCorrect">0</div>
                    <div class="stat-label">Correctas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value incorrect" id="writingIncorrect">0</div>
                    <div class="stat-label">Errores</div>
                </div>
            </div>

            <div class="clock-container">
                <div class="clock">
                    <div class="clock-face">
                        <span class="clock-number n12">12</span>
                        <span class="clock-number n1">1</span>
                        <span class="clock-number n2">2</span>
                        <span class="clock-number n3">3</span>
                        <span class="clock-number n4">4</span>
                        <span class="clock-number n5">5</span>
                        <span class="clock-number n6">6</span>
                        <span class="clock-number n7">7</span>
                        <span class="clock-number n8">8</span>
                        <span class="clock-number n9">9</span>
                        <span class="clock-number n10">10</span>
                        <span class="clock-number n11">11</span>
                    </div>
                    <div class="hour-hand" id="writingHourHand"></div>
                    <div class="minute-hand" id="writingMinuteHand"></div>
                    <div class="clock-center"></div>
                </div>
            </div>


            <div class="digital-time" id="writingDigitalTime">07:30</div>
            <div class="date-display-large" id="writingDateDisplay">
                04.09.
            </div>

            <div class="writing-section">
                <div class="input-group">
                    <label class="input-label" id="label1">
                        <span class="badge unofficial" id="badge1">No Oficial</span>
                        <span id="text1">Escribe la forma coloquial:</span>
                    </label>
                    <input type="text" class="time-input" id="unofficialInput" placeholder="Es ist..."
                        autocomplete="off">
                    <div class="input-feedback" id="unofficialFeedback"></div>
                </div>

                <div class="input-group">
                    <label class="input-label" id="label2">
                        <span class="badge official" id="badge2">Oficial</span>
                        <span id="text2">Escribe la forma formal:</span>
                    </label>
                    <input type="text" class="time-input" id="officialInput" placeholder="Es ist..." autocomplete="off">
                    <div class="input-feedback" id="officialFeedback"></div>
                </div>

                <div class="buttons">
                    <button class="btn btn-secondary" onclick="clearWritingAnswer()">üîÑ Limpiar</button>
                    <button class="btn btn-primary" onclick="checkWritingAnswer()">‚úì Comprobar</button>
                </div>
            </div>


        </div>
    </div>

    <script>
        // ========== SCREEN MANAGEMENT ==========
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showStudyTab(tab) {
            document.querySelectorAll('.study-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.study-tab-content').forEach(c => c.classList.remove('active'));

            if (tab === 'unofficial') {
                document.querySelector('.study-tab:nth-child(1)').classList.add('active');
                document.getElementById('studyUnofficial').classList.add('active');
            } else if (tab === 'official') {
                document.querySelector('.study-tab:nth-child(2)').classList.add('active');
                document.getElementById('studyOfficial').classList.add('active');
            } else if (tab === 'birthday') {
                document.querySelector('.study-tab:nth-child(3)').classList.add('active');
                document.getElementById('studyBirthday').classList.add('active');
            } else if (tab === 'possessive') {
                document.querySelector('.study-tab:nth-child(4)').classList.add('active');
                document.getElementById('studyPossessive').classList.add('active');
            } else if (tab === 'modal') {
                document.querySelector('.study-tab:nth-child(5)').classList.add('active');
                document.getElementById('studyModal').classList.add('active');
            }
        }

        function startGame(mode) {
            currentMode = mode;
            stats = { streak: 0, correct: 0, incorrect: 0 };
            updateStats();

            const title = document.getElementById('gameModeTitle');
            const clockContainer = document.querySelector('.clock-container');
            const digitalTime = document.getElementById('digitalTime');
            const dateDisplay = document.getElementById('dateDisplay');
            const grammarQuestion = document.getElementById('grammarQuestion');

            // Reset visibility
            if (clockContainer) clockContainer.style.display = 'flex';
            if (digitalTime) digitalTime.style.display = 'block';
            if (dateDisplay) dateDisplay.style.display = 'none';
            if (grammarQuestion) grammarQuestion.style.display = 'none';

            // Update Instruction Text
            const instruction = document.querySelector('.instruction');
            if (instruction) {
                if (mode === 'possessive') {
                    instruction.textContent = 'Completa la frase con el posesivo correcto:';
                } else if (mode === 'modal') {
                    instruction.textContent = 'Ordena la frase correctamente:';
                } else if (mode.startsWith('birthday')) {
                    instruction.textContent = 'Ordena las palabras para formar la fecha correcta:';
                } else {
                    instruction.textContent = 'Ordena las palabras para formar la hora correcta:';
                }
            }

            if (mode === 'unofficial') {
                title.textContent = 'üó£Ô∏è Forma No Oficial';
                title.className = 'unofficial';
            } else if (mode === 'official') {
                title.textContent = 'üì¢ Forma Oficial';
                title.className = 'official';
            } else if (mode.startsWith('birthday')) {
                // ... birthday logic existing ...
                if (mode === 'birthday_words') {
                    title.textContent = 'üìÖ Geburtstage (Nombres)';
                } else if (mode === 'birthday_numbers') {
                    title.textContent = 'üî¢ Geburtstage (N√∫meros)';
                }
                title.className = 'birthday';
                if (clockContainer) clockContainer.style.display = 'none';
                if (digitalTime) digitalTime.style.display = 'none';
                if (dateDisplay) dateDisplay.style.display = 'block';
            } else if (mode === 'possessive') {
                title.textContent = 'üéí Possessivartikel';
                title.className = 'grammar';
                if (clockContainer) clockContainer.style.display = 'none';
                if (digitalTime) digitalTime.style.display = 'none';
                if (grammarQuestion) grammarQuestion.style.display = 'block';
            } else if (mode === 'modal') {
                title.textContent = '‚ö° Modalverben';
                title.className = 'grammar';
                if (clockContainer) clockContainer.style.display = 'none';
                if (digitalTime) digitalTime.style.display = 'none';
                if (grammarQuestion) grammarQuestion.style.display = 'block';
            }

            // Clean previous state
            if (typeof clearAnswer === 'function') clearAnswer();

            showScreen('gameScreen');
            generateNewTime();
        }

        // ========== GAME LOGIC ==========
        const numberWords = {
            0: 'null', 1: 'eins', 2: 'zwei', 3: 'drei', 4: 'vier',
            5: 'f√ºnf', 6: 'sechs', 7: 'sieben', 8: 'acht', 9: 'neun',
            10: 'zehn', 11: 'elf', 12: 'zw√∂lf', 13: 'dreizehn', 14: 'vierzehn',
            15: 'f√ºnfzehn', 16: 'sechzehn', 17: 'siebzehn', 18: 'achtzehn',
            19: 'neunzehn', 20: 'zwanzig', 21: 'einundzwanzig', 22: 'zweiundzwanzig',
            23: 'dreiundzwanzig', 24: 'vierundzwanzig', 25: 'f√ºnfundzwanzig',
            26: 'sechsundzwanzig', 27: 'siebenundzwanzig', 28: 'achtundzwanzig',
            29: 'neunundzwanzig', 30: 'drei√üig', 31: 'einunddrei√üig',
            32: 'zweiunddrei√üig', 33: 'dreiunddrei√üig', 34: 'vierunddrei√üig',
            35: 'f√ºnfunddrei√üig', 36: 'sechsunddrei√üig', 37: 'siebenunddrei√üig',
            38: 'achtunddrei√üig', 39: 'neununddrei√üig', 40: 'vierzig',
            41: 'einundvierzig', 42: 'zweiundvierzig', 43: 'dreiundvierzig',
            44: 'vierundvierzig', 45: 'f√ºnfundvierzig', 46: 'sechsundvierzig',
            47: 'siebenundvierzig', 48: 'achtundvierzig', 49: 'neunundvierzig',
            50: 'f√ºnfzig', 51: 'einundf√ºnfzig', 52: 'zweiundf√ºnfzig',
            53: 'dreiundf√ºnfzig', 54: 'vierundf√ºnfzig', 55: 'f√ºnfundf√ºnfzig',
            56: 'sechsundf√ºnfzig', 57: 'siebenundf√ºnfzig', 58: 'achtundf√ºnfzig',
            59: 'neunundf√ºnfzig'
        };

        const hourWords = {
            1: 'eins', 2: 'zwei', 3: 'drei', 4: 'vier', 5: 'f√ºnf',
            6: 'sechs', 7: 'sieben', 8: 'acht', 9: 'neun', 10: 'zehn',
            11: 'elf', 12: 'zw√∂lf'
        };

        const monthNames = [
            "", "Januar", "Februar", "M√§rz", "April", "Mai", "Juni",
            "Juli", "August", "September", "Oktober", "November", "Dezember"
        ];

        let currentMode = 'unofficial';
        let currentHour = 7;
        let currentMinute = 30;
        let currentDay = 1;
        let currentMonth = 1;
        let correctAnswer = [];
        let selectedWords = [];
        let stats = { streak: 0, correct: 0, incorrect: 0 };

        const hourHand = document.getElementById('hourHand');
        const minuteHand = document.getElementById('minuteHand');
        const digitalTime = document.getElementById('digitalTime');
        const answerSlots = document.getElementById('answerSlots');
        const wordOptions = document.getElementById('wordOptions');
        const feedback = document.getElementById('feedback');
        const correctAnswerDisplay = document.getElementById('correctAnswerDisplay');
        const correctAnswerText = document.getElementById('correctAnswerText');

        function updateClock(hour, minute) {
            const hourDeg = ((hour % 12) * 30) + (minute * 0.5);
            const minuteDeg = minute * 6;

            hourHand.style.transform = `rotate(${hourDeg}deg)`;
            minuteHand.style.transform = `rotate(${minuteDeg}deg)`;

            const displayHour = String(hour).padStart(2, '0');
            const displayMinute = String(minute).padStart(2, '0');
            digitalTime.textContent = `${displayHour}:${displayMinute}`;
        }

        function getHour12(hour) {
            if (hour === 0) return 12;
            if (hour > 12) return hour - 12;
            return hour;
        }

        function getNextHour12(hour) {
            const h12 = getHour12(hour);
            return h12 === 12 ? 1 : h12 + 1;
        }

        function generateUnofficialTime(hour, minute) {
            const h12 = getHour12(hour);
            const nextH = getNextHour12(hour);
            const roundedMinute = Math.round(minute / 5) * 5;

            switch (roundedMinute) {
                case 0: return ['Es', 'ist', hourWords[h12], 'Uhr'];
                case 5: return ['Es', 'ist', 'f√ºnf', 'nach', hourWords[h12]];
                case 10: return ['Es', 'ist', 'zehn', 'nach', hourWords[h12]];
                case 15: return ['Es', 'ist', 'Viertel', 'nach', hourWords[h12]];
                case 20: return ['Es', 'ist', 'zwanzig', 'nach', hourWords[h12]];
                case 25: return ['Es', 'ist', 'f√ºnf', 'vor', 'halb', hourWords[nextH]];
                case 30: return ['Es', 'ist', 'halb', hourWords[nextH]];
                case 35: return ['Es', 'ist', 'f√ºnf', 'nach', 'halb', hourWords[nextH]];
                case 40: return ['Es', 'ist', 'zwanzig', 'vor', hourWords[nextH]];
                case 45: return ['Es', 'ist', 'Viertel', 'vor', hourWords[nextH]];
                case 50: return ['Es', 'ist', 'zehn', 'vor', hourWords[nextH]];
                case 55: return ['Es', 'ist', 'f√ºnf', 'vor', hourWords[nextH]];
                case 60: return ['Es', 'ist', hourWords[nextH], 'Uhr'];
                default: return ['Es', 'ist', hourWords[h12], 'Uhr'];
            }
        }

        function generateOfficialTime(hour, minute) {
            const h12 = getHour12(hour);

            if (minute === 0) {
                return ['Es', 'ist', hourWords[h12], 'Uhr'];
            } else {
                return ['Es', 'ist', hourWords[h12], 'Uhr', numberWords[minute]];
            }
        }

        function getOrdinalStem(n) {
            // Irregular stems
            if (n === 1) return 'ers';
            if (n === 3) return 'drit';
            if (n === 7) return 'sieb';
            if (n === 8) return 'ach'; // acht -> ach + ten

            // Regular stems
            return numberWords[n];
        }

        function generateBirthday(day, month, mode) {
            const dayStem = getOrdinalStem(day);
            const daySuffix = (day < 20) ? 'ten' : 'sten';
            const dayWord = dayStem + daySuffix;

            if (mode === 'birthday_words') {
                // "am vierten Mai"
                return ['am', dayWord, monthNames[month]];
            } else {
                // "am vierten F√ºnften"
                const monthStem = getOrdinalStem(month);
                const monthSuffix = (month < 20) ? 'ten' : 'sten';
                let monthWord = monthStem + monthSuffix;
                // Capitalize noun
                monthWord = monthWord.charAt(0).toUpperCase() + monthWord.slice(1);

                return ['am', dayWord, monthWord];
            }
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function generateGrammarQuestion(mode) {
            if (mode === 'possessive') {
                const subjects = [
                    { pronoun: 'ich', possessive: 'mein', name: 'yo' },
                    { pronoun: 'du', possessive: 'dein', name: 't√∫' },
                    { pronoun: 'er', possessive: 'sein', name: '√©l' },
                    { pronoun: 'sie', possessive: 'ihr', name: 'ella' },
                    { pronoun: 'wir', possessive: 'unser', name: 'nosotros' },
                    { pronoun: 'ihr', possessive: 'euer', name: 'vosotros' }
                ];

                const nouns = [
                    { word: 'Vater', gender: 'm' },     // der
                    { word: 'Mutter', gender: 'f' },    // die
                    { word: 'Buch', gender: 'n' },      // das
                    { word: 'Bruder', gender: 'm' },    // der
                    { word: 'Schwester', gender: 'f' }, // die
                    { word: 'Auto', gender: 'n' },      // das
                    { word: 'Eltern', gender: 'p' },    // die (pl)
                    { word: 'Haus', gender: 'n' },      // das
                    { word: 'Katze', gender: 'f' },     // die
                    { word: 'Hund', gender: 'm' }       // der
                ];

                const subject = subjects[Math.floor(Math.random() * subjects.length)];
                const noun = nouns[Math.floor(Math.random() * nouns.length)];

                // Logic: 
                // m/n -> mein, dein, sein...
                // f/p -> meine, deine, seine...
                let answer = subject.possessive;
                if (noun.gender === 'f' || noun.gender === 'p') {
                    if (subject.pronoun === 'euer') {
                        answer = 'eure'; // irregular (euer -> eure)
                    } else {
                        answer += 'e';
                    }
                }

                const questionHTML = `
                    <span class="grammar-pronoun">(${subject.pronoun})</span><br>
                    Das ist ... <strong>${noun.word}</strong>.
                `;
                document.getElementById('grammarQuestion').innerHTML = questionHTML;

                return [answer];

            } else if (mode === 'modal') {
                const modals = [
                    { inf: 'm√ºssen', conj: ['muss', 'musst', 'muss', 'm√ºssen', 'm√ºsst', 'm√ºssen'] },
                    { inf: 'k√∂nnen', conj: ['kann', 'kannst', 'kann', 'k√∂nnen', 'k√∂nnt', 'k√∂nnen'] },
                    { inf: 'wollen', conj: ['will', 'willst', 'will', 'wollen', 'wollt', 'wollen'] }
                ];
                const pronouns = ['ich', 'du', 'er', 'wir', 'ihr', 'sie'];

                // Sentence templates: Object + MainVerb
                const templates = [
                    { obj: 'nach Hause', verb: 'gehen', hint: 'go home' },
                    { obj: 'Deutsch', verb: 'lernen', hint: 'learn German' },
                    { obj: 'eine Pizza', verb: 'essen', hint: 'eat a pizza' },
                    { obj: 'Wasser', verb: 'trinken', hint: 'drink water' },
                    { obj: 'Fussball', verb: 'spielen', hint: 'play football' },
                    { obj: 'Musik', verb: 'h√∂ren', hint: 'listen to music' }
                ];

                const modal = modals[Math.floor(Math.random() * modals.length)];
                const pIndex = Math.floor(Math.random() * pronouns.length);
                const pronoun = pronouns[pIndex];
                const conjugatedModal = modal.conj[pIndex];
                const template = templates[Math.floor(Math.random() * templates.length)];

                // Construct sentence: Subject + Modal + Object + Verb
                // Capitalize Subject if 'ich' or others (usually start of sentence)
                const subjectDisplay = pronoun.charAt(0).toUpperCase() + pronoun.slice(1);

                // Objects might be multi-word, keep them as is or split if we want high difficulty. 
                // For now, let's keep object as one unit or split if simple.
                // Let's split simple objects? "nach Hause" -> ["nach", "Hause"] or keep together?
                // The clock game keeps "Viertel nach" as separate words.
                // Let's separate words.

                const objectWords = template.obj.split(' ');

                // Full correct answer array
                const answerList = [subjectDisplay, conjugatedModal, ...objectWords, template.verb];

                // Question Display
                const questionHTML = `
                    <div style="font-size: 1.2rem; display: flex; flex-direction: column; gap: 10px; align-items: center;">
                        <div style="color: var(--accent-secondary); font-weight: bold;">
                             ${pronoun} / ${modal.inf} / ${template.obj} / ${template.verb}
                        </div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">
                            Ordena la frase correctamente
                        </div>
                    </div>
                `;
                document.getElementById('grammarQuestion').innerHTML = questionHTML;

                return answerList;
            }
            return [];
        }

        function generateNewTime() {
            selectedWords = [];
            feedback.className = 'feedback';
            correctAnswerDisplay.classList.remove('show');
            answerSlots.className = 'answer-slots';

            if (currentMode === 'possessive' || currentMode === 'modal') {
                correctAnswer = generateGrammarQuestion(currentMode);
                let allWords = [...correctAnswer];
                const distractors = generateDistractors();
                distractors.forEach(word => {
                    if (!allWords.includes(word)) allWords.push(word);
                });
                renderWordOptions(shuffleArray(allWords));
                renderAnswerSlots();
                return;
            }

            if (currentMode === 'unofficial') {
                currentHour = Math.floor(Math.random() * 12) + 1;
                currentMinute = Math.floor(Math.random() * 12) * 5;
            } else if (currentMode === 'official') {
                currentHour = Math.floor(Math.random() * 24);
                const useCommon = Math.random() > 0.3;
                currentMinute = useCommon ? Math.floor(Math.random() * 12) * 5 : Math.floor(Math.random() * 60);
            } else if (currentMode.startsWith('birthday')) {
                // Generate valid date
                currentMonth = Math.floor(Math.random() * 12) + 1;
                // Days in month approx (simplified for game, or accurate)
                // Let's be accurate enough: 1-28 for all to be safe, or logic
                const daysInMonth = new Date(2023, currentMonth, 0).getDate();
                currentDay = Math.floor(Math.random() * daysInMonth) + 1;

                // Update display
                const dayStr = String(currentDay).padStart(2, '0');
                const monthStr = String(currentMonth).padStart(2, '0');
                if (document.getElementById('dateDisplay')) {
                    document.getElementById('dateDisplay').textContent = `${dayStr}.${monthStr}.`;
                }
            }

            updateClock(currentHour, currentMinute);

            if (currentMode === 'unofficial') {
                correctAnswer = generateUnofficialTime(currentHour, currentMinute);
            } else if (currentMode === 'official') {
                correctAnswer = generateOfficialTime(currentHour, currentMinute);
            } else {
                correctAnswer = generateBirthday(currentDay, currentMonth, currentMode);
            }

            let allWords = [...correctAnswer];
            const distractors = generateDistractors();
            distractors.forEach(word => {
                if (!allWords.includes(word)) allWords.push(word);
            });

            renderWordOptions(shuffleArray(allWords));
            renderAnswerSlots();
        }

        function generateDistractors() {
            const distractors = [];

            if (currentMode === 'unofficial') {
                const common = ['vor', 'nach', 'halb', 'Viertel', 'Uhr'];
                const times = ['f√ºnf', 'zehn', 'zwanzig'];
                distractors.push(...common.slice(0, 2));
                distractors.push(hourWords[Math.floor(Math.random() * 12) + 1]);
                distractors.push(times[Math.floor(Math.random() * times.length)]);
            } else if (currentMode === 'official') {
                distractors.push(numberWords[Math.floor(Math.random() * 60)]);
                distractors.push(hourWords[Math.floor(Math.random() * 12) + 1]);
                distractors.push('Uhr');
            } else if (currentMode.startsWith('birthday')) {
                distractors.push('am');

                // Add random day ordinal
                const rDay = Math.floor(Math.random() * 31) + 1;
                const rDayStem = getOrdinalStem(rDay);
                const rDaySuffix = (rDay < 20) ? 'ten' : 'sten';
                distractors.push(rDayStem + rDaySuffix);

                if (currentMode === 'birthday_words') {
                    // Add random month name
                    const rMonth = Math.floor(Math.random() * 12) + 1;
                    distractors.push(monthNames[rMonth]);
                } else if (currentMode === 'birthday_numbers') {
                    // Add random month ordinal (capitalized)
                    const rMonth = Math.floor(Math.random() * 12) + 1;
                    const rMonthStem = getOrdinalStem(rMonth);
                    const rMonthSuffix = (rMonth < 20) ? 'ten' : 'sten';
                    let rWord = rMonthStem + rMonthSuffix;
                    rWord = rWord.charAt(0).toUpperCase() + rWord.slice(1);
                    distractors.push(rWord);
                }
            } else if (currentMode === 'possessive') {
                // return other possessives as distractors
                const allPoss = ['mein', 'meine', 'dein', 'deine', 'sein', 'seine', 'ihr', 'ihre', 'unser', 'unsere', 'euer', 'eure'];
                // Pick 3 random
                for (let i = 0; i < 3; i++) {
                    distractors.push(allPoss[Math.floor(Math.random() * allPoss.length)]);
                }
            } else if (currentMode === 'modal') {
                // Return other conjugations as distractors
                const allConj = ['muss', 'musst', 'm√ºssen', 'm√ºsst', 'kann', 'kannst', 'k√∂nnen', 'k√∂nnt', 'will', 'willst', 'wollen', 'wollt'];
                // Also add infinitive as distractor?
                // And maybe wrong verb form?
                for (let i = 0; i < 4; i++) {
                    const rWord = allConj[Math.floor(Math.random() * allConj.length)];
                    // Avoid adding if it's already in the answer (which we can't check easily here without passing it, 
                    // but the main function filters it out).
                    distractors.push(rWord);
                }
            }

            return distractors;
        }

        function renderWordOptions(words) {
            wordOptions.innerHTML = '';
            words.forEach((word, index) => {
                const chip = document.createElement('div');
                chip.className = 'word-chip';
                chip.textContent = word;
                chip.dataset.index = index;
                chip.dataset.word = word;
                chip.onclick = () => selectWord(chip, word);
                wordOptions.appendChild(chip);
            });
        }

        function renderAnswerSlots() {
            answerSlots.innerHTML = '';
            selectedWords.forEach((word, index) => {
                const chip = document.createElement('div');
                chip.className = 'word-chip selected';
                chip.textContent = word;
                chip.onclick = () => removeWord(index);
                answerSlots.appendChild(chip);
            });
        }

        function selectWord(element, word) {
            if (element.classList.contains('in-answer')) return;
            selectedWords.push(word);
            element.classList.add('in-answer');
            renderAnswerSlots();
        }

        function removeWord(index) {
            const removedWord = selectedWords[index];
            selectedWords.splice(index, 1);

            const chips = document.querySelectorAll('#wordOptions .word-chip');
            for (const chip of chips) {
                if (chip.dataset.word === removedWord && chip.classList.contains('in-answer')) {
                    chip.classList.remove('in-answer');
                    break;
                }
            }

            renderAnswerSlots();
        }

        function clearAnswer() {
            selectedWords = [];
            document.querySelectorAll('.word-chip').forEach(chip => chip.classList.remove('in-answer'));
            renderAnswerSlots();
            feedback.className = 'feedback';
            correctAnswerDisplay.classList.remove('show');
            answerSlots.className = 'answer-slots';
        }

        function checkAnswer() {
            if (selectedWords.length === 0) return;

            const isCorrect = JSON.stringify(selectedWords) === JSON.stringify(correctAnswer);

            if (isCorrect) {
                stats.correct++;
                stats.streak++;
                feedback.textContent = 'üéâ ¬°Perfecto! Sehr gut!';
                feedback.className = 'feedback correct show';
                answerSlots.classList.add('correct');
                setTimeout(() => generateNewTime(), 1500);
            } else {
                stats.incorrect++;
                stats.streak = 0;
                feedback.textContent = '‚ùå ¬°Int√©ntalo de nuevo!';
                feedback.className = 'feedback incorrect show';
                answerSlots.classList.add('incorrect');
                correctAnswerText.textContent = correctAnswer.join(' ');
                correctAnswerDisplay.classList.add('show');
            }

            updateStats();
        }

        function updateStats() {
            document.getElementById('streak').textContent = stats.streak;
            document.getElementById('correct').textContent = stats.correct;
            document.getElementById('incorrect').textContent = stats.incorrect;
        }

        // ========== WRITING MODE LOGIC ==========
        let writingStats = { streak: 0, correct: 0, incorrect: 0 };
        let writingHour = 7;
        let writingMinute = 30;
        let writingDay = 1;
        let writingMonth = 1;
        let writingMode = 'time'; // 'time' or 'birthday'
        let correctUnofficialAnswer = '';
        let correctOfficialAnswer = '';

        function startWritingGame(mode = 'time') {
            writingMode = mode;
            writingStats = { streak: 0, correct: 0, incorrect: 0 };
            updateWritingStats();
            showScreen('writingScreen');

            // Adjust UI based on mode
            const title = document.getElementById('writingModeTitle');
            const clock = document.querySelector('#writingScreen .clock-container');
            const digi = document.getElementById('writingDigitalTime');
            const date = document.getElementById('writingDateDisplay');

            const badge1 = document.getElementById('badge1');
            const text1 = document.getElementById('text1');
            const badge2 = document.getElementById('badge2');
            const text2 = document.getElementById('text2');
            const input1 = document.getElementById('unofficialInput');
            const input2 = document.getElementById('officialInput');

            // Reset classes
            badge1.className = 'badge';
            badge2.className = 'badge';

            if (writingMode === 'birthday') {
                title.textContent = '‚úçÔ∏è Escribe el Cumplea√±os';
                title.className = 'birthday';
                clock.style.display = 'none';
                digi.style.display = 'none';
                date.style.display = 'block';

                badge1.textContent = 'Con Mes';
                badge1.classList.add('birthday');
                text1.textContent = 'Ej: am vierten Mai';
                input1.placeholder = 'am ...';

                badge2.textContent = 'Con N√∫meros';
                badge2.classList.add('birthday');
                text2.textContent = 'Ej: am vierten F√ºnften';
                input2.placeholder = 'am ...';

                generateWritingDate();
            } else {
                title.textContent = '‚úçÔ∏è Modo Escritura';
                title.className = 'writing';
                clock.style.display = 'flex';
                digi.style.display = 'block';
                date.style.display = 'none';

                badge1.textContent = 'No Oficial';
                badge1.classList.add('unofficial');
                text1.textContent = 'Escribe la forma coloquial:';
                input1.placeholder = 'Es ist...';

                badge2.textContent = 'Oficial';
                badge2.classList.add('official');
                text2.textContent = 'Escribe la forma formal:';
                input2.placeholder = 'Es ist...';

                generateWritingTime();
            }
        }

        function updateWritingClock(hour, minute) {
            const hourHand = document.getElementById('writingHourHand');
            const minuteHand = document.getElementById('writingMinuteHand');
            const digitalTime = document.getElementById('writingDigitalTime');

            const hourDeg = ((hour % 12) * 30) + (minute * 0.5);
            const minuteDeg = minute * 6;

            hourHand.style.transform = `rotate(${hourDeg}deg)`;
            minuteHand.style.transform = `rotate(${minuteDeg}deg)`;

            const displayHour = String(hour).padStart(2, '0');
            const displayMinute = String(minute).padStart(2, '0');
            digitalTime.textContent = `${displayHour}:${displayMinute}`;
        }

        function generateWritingTime() {
            // Clear inputs
            document.getElementById('unofficialInput').value = '';
            document.getElementById('officialInput').value = '';
            document.getElementById('unofficialInput').className = 'time-input';
            document.getElementById('officialInput').className = 'time-input';
            document.getElementById('unofficialFeedback').className = 'input-feedback';
            document.getElementById('officialFeedback').className = 'input-feedback';

            // Generate random time (only intervals of 5 minutes)
            writingHour = Math.floor(Math.random() * 12) + 1;
            writingMinute = Math.floor(Math.random() * 12) * 5;

            updateWritingClock(writingHour, writingMinute);

            // Generate correct answers
            correctUnofficialAnswer = generateUnofficialTime(writingHour, writingMinute).join(' ');
            correctOfficialAnswer = generateOfficialTime(writingHour, writingMinute).join(' ');
        }

        function generateWritingDate() {
            // Clear inputs
            document.getElementById('unofficialInput').value = '';
            document.getElementById('officialInput').value = '';
            document.getElementById('unofficialInput').className = 'time-input';
            document.getElementById('officialInput').className = 'time-input';
            document.getElementById('unofficialFeedback').className = 'input-feedback';
            document.getElementById('officialFeedback').className = 'input-feedback';

            // Generate date
            writingMonth = Math.floor(Math.random() * 12) + 1;
            const daysInMonth = new Date(2023, writingMonth, 0).getDate();
            writingDay = Math.floor(Math.random() * daysInMonth) + 1;

            const dayStr = String(writingDay).padStart(2, '0');
            const monthStr = String(writingMonth).padStart(2, '0');
            document.getElementById('writingDateDisplay').textContent = `${dayStr}.${monthStr}.`;

            // Generate answers
            correctUnofficialAnswer = generateBirthday(writingDay, writingMonth, 'birthday_words').join(' ');
            correctOfficialAnswer = generateBirthday(writingDay, writingMonth, 'birthday_numbers').join(' ');
        }

        function normalizeAnswer(text) {
            return text.toLowerCase()
                .trim()
                .replace(/\s+/g, ' ')
                .replace(/√ü/g, 'ss')
                .replace(/√º/g, 'ue');
        }

        function checkWritingAnswer() {
            const unofficialInput = document.getElementById('unofficialInput');
            const officialInput = document.getElementById('officialInput');
            const unofficialFeedback = document.getElementById('unofficialFeedback');
            const officialFeedback = document.getElementById('officialFeedback');

            const userUnofficial = unofficialInput.value.trim();
            const userOfficial = officialInput.value.trim();

            if (!userUnofficial && !userOfficial) return;

            const unofficialCorrect = normalizeAnswer(userUnofficial) === normalizeAnswer(correctUnofficialAnswer);
            const officialCorrect = normalizeAnswer(userOfficial) === normalizeAnswer(correctOfficialAnswer);

            // Unofficial feedback
            if (userUnofficial) {
                if (unofficialCorrect) {
                    unofficialInput.className = 'time-input correct';
                    unofficialFeedback.textContent = '‚úì ¬°Correcto!';
                    unofficialFeedback.className = 'input-feedback correct show';
                } else {
                    unofficialInput.className = 'time-input incorrect';
                    unofficialFeedback.textContent = '‚úó Correcto: ' + correctUnofficialAnswer;
                    unofficialFeedback.className = 'input-feedback incorrect show';
                }
            }

            // Official feedback
            if (userOfficial) {
                if (officialCorrect) {
                    officialInput.className = 'time-input correct';
                    officialFeedback.textContent = '‚úì ¬°Correcto!';
                    officialFeedback.className = 'input-feedback correct show';
                } else {
                    officialInput.className = 'time-input incorrect';
                    officialFeedback.textContent = '‚úó Correcto: ' + correctOfficialAnswer;
                    officialFeedback.className = 'input-feedback incorrect show';
                }
            }

            // Update stats
            const bothCorrect = unofficialCorrect && officialCorrect;

            if (bothCorrect) {
                writingStats.correct++;
                writingStats.streak++;
                const delay = writingMode === 'birthday' ? generateWritingDate : generateWritingTime;
                setTimeout(delay, 1500);
            } else {
                writingStats.incorrect++;
                writingStats.streak = 0;
            }

            updateWritingStats();
        }

        function clearWritingAnswer() {
            document.getElementById('unofficialInput').value = '';
            document.getElementById('officialInput').value = '';
            document.getElementById('unofficialInput').className = 'time-input';
            document.getElementById('officialInput').className = 'time-input';
            document.getElementById('unofficialFeedback').className = 'input-feedback';
            document.getElementById('officialFeedback').className = 'input-feedback';
        }

        function updateWritingStats() {
            document.getElementById('writingStreak').textContent = writingStats.streak;
            document.getElementById('writingCorrect').textContent = writingStats.correct;
            document.getElementById('writingIncorrect').textContent = writingStats.incorrect;
        }

        // Override startGame to handle writing mode
        const originalStartGame = startGame;
        startGame = function (mode) {
            if (mode === 'writing') {
                startWritingGame('time');
            } else if (mode === 'birthday_writing') {
                startWritingGame('birthday');
            } else {
                originalStartGame(mode);
            }
        };

        // Add CSS for study tab content
        const style = document.createElement('style');
        style.textContent = `
            .study-tab-content {
                display: none;
            }
            .study-tab-content.active {
                display: block;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>